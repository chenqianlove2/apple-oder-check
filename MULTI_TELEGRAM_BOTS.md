# 🤖 多 Telegram 机器人功能说明

## ✨ 新功能特性

现在支持添加**多个 Telegram 机器人**，订单状态变更时会同时通知所有启用的机器人！

---

## 📋 功能列表

### 1. 添加机器人
- ✅ 支持添加无限个 Telegram 机器人
- ✅ 每个机器人可自定义名称（便于识别）
- ✅ 独立配置 Bot Token 和 Chat ID

### 2. 管理机器人
- ✅ 启用/禁用：可以临时禁用某个机器人而不删除
- ✅ 编辑：修改机器人的名称、Token、Chat ID
- ✅ 删除：移除不需要的机器人
- ✅ 测试：单独测试每个机器人的连接状态

### 3. 自动通知
- ✅ 订单状态变更时，自动发送到**所有启用的机器人**
- ✅ 即使某个机器人发送失败，其他机器人仍会收到通知
- ✅ 支持多人同时接收订单状态更新

---

## 🎯 使用场景

### 场景 1：团队协作
```
机器人 1：老板通知群
机器人 2：客服通知群  
机器人 3：仓库通知群
```
一个订单状态更新，三个群同时收到通知！

### 场景 2：多账号管理
```
机器人 1：个人主账号
机器人 2：工作账号
机器人 3：备用账号
```
确保无论在哪个账号都能及时看到通知！

### 场景 3：备份机制
```
机器人 1：主要通知机器人
机器人 2：备份机器人
```
如果主机器人出问题，备份机器人确保不会漏掉重要通知！

---

## 📱 操作步骤

### 1. 访问设置页面
```
http://app.moneych.top/settings
```

### 2. 添加第一个机器人

1. 点击 **"➕ 添加机器人"** 按钮
2. 填写信息：
   ```
   机器人名称：主通知机器人
   Bot Token：从 @BotFather 获取
   Chat ID：从 @userinfobot 获取
   ```
3. 点击 **"🧪 测试连接"** 验证配置
4. 点击 **"💾 保存"**

### 3. 添加更多机器人

重复上面的步骤，可以添加任意多个机器人！

### 4. 管理机器人

- **启用/禁用**：点击对应按钮即可
- **编辑**：点击 ✏️ 编辑按钮修改配置
- **删除**：点击 🗑️ 删除按钮移除
- **测试**：点击 🧪 测试按钮验证连接

---

## 💡 最佳实践

### ✅ 建议做法

1. **命名清晰**
   ```
   ✅ 好：老板通知群、客服1号机器人、John的Telegram
   ❌ 差：Bot1、机器人、test
   ```

2. **至少配置 2 个机器人**
   - 一个主要的
   - 一个备份的
   - 避免单点故障

3. **定期测试**
   - 每周测试一次所有机器人
   - 确保 Token 和 Chat ID 有效

4. **及时禁用**
   - 如果某个群不再需要通知，禁用而不是删除
   - 方便后续重新启用

### ⚠️ 注意事项

1. **Token 安全**
   - 不要分享 Bot Token
   - 如果泄露，立即在 @BotFather 重新生成

2. **Chat ID 获取**
   - 个人账号：从 @userinfobot 获取
   - 群组：添加机器人到群，发送消息后访问 API 查看
   ```
   https://api.telegram.org/bot<你的Token>/getUpdates
   ```

3. **测试连接**
   - 保存前一定要测试
   - 避免配置错误导致收不到通知

---

## 🔧 技术细节

### 配置文件
```json
{
  "bots": [
    {
      "id": "uuid-1",
      "name": "主通知机器人",
      "bot_token": "123456789:ABCdefGHI...",
      "chat_id": "12345678",
      "enabled": true
    },
    {
      "id": "uuid-2",
      "name": "备份机器人",
      "bot_token": "987654321:XYZabc123...",
      "chat_id": "87654321",
      "enabled": true
    }
  ]
}
```

### API 端点

```javascript
// 获取机器人列表
GET /api/telegram/bots

// 添加机器人
POST /api/telegram/bots/add
{
  "name": "机器人名称",
  "bot_token": "...",
  "chat_id": "..."
}

// 更新机器人
POST /api/telegram/bots/update
{
  "bot_id": "uuid",
  "name": "新名称",  // 可选
  "bot_token": "...",  // 可选
  "chat_id": "...",  // 可选
  "enabled": true  // 可选
}

// 删除机器人
POST /api/telegram/bots/delete
{
  "bot_id": "uuid"
}

// 测试连接
POST /api/telegram/test
{
  "bot_token": "...",
  "chat_id": "..."
}
```

---

## 🎉 示例通知效果

当订单状态变更时，**所有启用的机器人**都会收到：

```
🚚 苹果订单状态变更

订单号: W1234567890
产品: iPhone 15 Pro
下单日期: 2026-02-01

状态变更:
⏳ Processing → 📦 Preparing to Ship

预计送达: Arrives Feb 16 - Feb 18

检测时间: 2026-02-08 14:30:00

🔗 查看订单详情
```

---

## ❓ 常见问题

### Q1: 最多可以添加多少个机器人？
**A**: 理论上无限制，但建议不超过 10 个，避免发送过慢。

### Q2: 如果某个机器人发送失败怎么办？
**A**: 其他机器人仍会正常发送，不会互相影响。

### Q3: 可以只通知某些机器人吗？
**A**: 目前会通知所有启用的机器人。如果不想某个机器人收到通知，可以暂时禁用它。

### Q4: 旧配置会丢失吗？
**A**: 不会！系统会自动迁移旧配置到新的多机器人格式。

### Q5: 如何获取群组的 Chat ID？
**A**: 
1. 将机器人添加到群组
2. 在群里发送任意消息
3. 访问：`https://api.telegram.org/bot<你的Token>/getUpdates`
4. 在返回的 JSON 中找到 `"chat":{"id":-100...}` 这就是 Chat ID

---

## 🚀 开始使用

1. 访问：http://app.moneych.top/settings
2. 点击"➕ 添加机器人"
3. 配置你的第一个机器人
4. 开始享受多机器人通知的便利！

如有问题，欢迎反馈！ 😊
